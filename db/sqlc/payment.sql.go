// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: payment.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countAllTransactions = `-- name: CountAllTransactions :one
SELECT COUNT(*) FROM lich_su_giao_dich
`

// Đếm tổng số giao dịch
func (q *Queries) CountAllTransactions(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countAllTransactions)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getAllTransactions = `-- name: GetAllTransactions :many

SELECT 
    lsgd.id,
    lsgd.dat_cho_id,
    lsgd.nguoi_dung_id,
    lsgd.ma_giao_dich_noi_bo,
    lsgd.ma_tham_chieu_cong_thanh_toan,
    lsgd.cong_thanh_toan_id,
    lsgd.so_tien,
    lsgd.loai_giao_dich,
    lsgd.trang_thai,
    lsgd.noi_dung_chuyen_khoan,
    lsgd.ngay_tao,
    lsgd.ngay_hoan_thanh,
    -- Thông tin booking
    dc.phuong_thuc_thanh_toan,
    -- Thông tin user
    nd.ho_ten AS ten_nguoi_dung,
    nd.email AS email_nguoi_dung,
    -- Thông tin tour
    t.tieu_de AS ten_tour,
    t.id AS tour_id,
    -- Thông tin cổng thanh toán
    ctt.ten_hien_thi AS ten_cong_thanh_toan
FROM lich_su_giao_dich lsgd
LEFT JOIN dat_cho dc ON dc.id = lsgd.dat_cho_id
LEFT JOIN nguoi_dung nd ON nd.id = lsgd.nguoi_dung_id
LEFT JOIN khoi_hanh_tour kh ON kh.id = dc.khoi_hanh_id
LEFT JOIN tour t ON t.id = kh.tour_id
LEFT JOIN cong_thanh_toan ctt ON ctt.id = lsgd.cong_thanh_toan_id
ORDER BY lsgd.ngay_tao DESC
LIMIT $1 OFFSET $2
`

type GetAllTransactionsParams struct {
	Limit  int32 `json:"limit"`
	Offset int32 `json:"offset"`
}

type GetAllTransactionsRow struct {
	ID                       int32                  `json:"id"`
	DatChoID                 *int32                 `json:"dat_cho_id"`
	NguoiDungID              pgtype.UUID            `json:"nguoi_dung_id"`
	MaGiaoDichNoiBo          string                 `json:"ma_giao_dich_noi_bo"`
	MaThamChieuCongThanhToan *string                `json:"ma_tham_chieu_cong_thanh_toan"`
	CongThanhToanID          *string                `json:"cong_thanh_toan_id"`
	SoTien                   pgtype.Numeric         `json:"so_tien"`
	LoaiGiaoDich             *string                `json:"loai_giao_dich"`
	TrangThai                NullTrangThaiThanhToan `json:"trang_thai"`
	NoiDungChuyenKhoan       *string                `json:"noi_dung_chuyen_khoan"`
	NgayTao                  pgtype.Timestamp       `json:"ngay_tao"`
	NgayHoanThanh            pgtype.Timestamp       `json:"ngay_hoan_thanh"`
	PhuongThucThanhToan      *string                `json:"phuong_thuc_thanh_toan"`
	TenNguoiDung             *string                `json:"ten_nguoi_dung"`
	EmailNguoiDung           *string                `json:"email_nguoi_dung"`
	TenTour                  *string                `json:"ten_tour"`
	TourID                   *int32                 `json:"tour_id"`
	TenCongThanhToan         *string                `json:"ten_cong_thanh_toan"`
}

// ==================== PAYMENT/TRANSACTION QUERIES ====================
// Lấy tất cả giao dịch với thông tin đầy đủ (dành cho Admin)
func (q *Queries) GetAllTransactions(ctx context.Context, arg GetAllTransactionsParams) ([]GetAllTransactionsRow, error) {
	rows, err := q.db.Query(ctx, getAllTransactions, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetAllTransactionsRow
	for rows.Next() {
		var i GetAllTransactionsRow
		if err := rows.Scan(
			&i.ID,
			&i.DatChoID,
			&i.NguoiDungID,
			&i.MaGiaoDichNoiBo,
			&i.MaThamChieuCongThanhToan,
			&i.CongThanhToanID,
			&i.SoTien,
			&i.LoaiGiaoDich,
			&i.TrangThai,
			&i.NoiDungChuyenKhoan,
			&i.NgayTao,
			&i.NgayHoanThanh,
			&i.PhuongThucThanhToan,
			&i.TenNguoiDung,
			&i.EmailNguoiDung,
			&i.TenTour,
			&i.TourID,
			&i.TenCongThanhToan,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getTransactionsByPaymentGateway = `-- name: GetTransactionsByPaymentGateway :many
SELECT 
    lsgd.id,
    lsgd.dat_cho_id,
    lsgd.nguoi_dung_id,
    lsgd.ma_giao_dich_noi_bo,
    lsgd.ma_tham_chieu_cong_thanh_toan,
    lsgd.cong_thanh_toan_id,
    lsgd.so_tien,
    lsgd.loai_giao_dich,
    lsgd.trang_thai,
    lsgd.noi_dung_chuyen_khoan,
    lsgd.ngay_tao,
    lsgd.ngay_hoan_thanh,
    dc.phuong_thuc_thanh_toan,
    nd.ho_ten AS ten_nguoi_dung,
    nd.email AS email_nguoi_dung,
    t.tieu_de AS ten_tour,
    t.id AS tour_id,
    ctt.ten_hien_thi AS ten_cong_thanh_toan
FROM lich_su_giao_dich lsgd
LEFT JOIN dat_cho dc ON dc.id = lsgd.dat_cho_id
LEFT JOIN nguoi_dung nd ON nd.id = lsgd.nguoi_dung_id
LEFT JOIN khoi_hanh_tour kh ON kh.id = dc.khoi_hanh_id
LEFT JOIN tour t ON t.id = kh.tour_id
LEFT JOIN cong_thanh_toan ctt ON ctt.id = lsgd.cong_thanh_toan_id
WHERE lsgd.cong_thanh_toan_id = $1
ORDER BY lsgd.ngay_tao DESC
LIMIT $2 OFFSET $3
`

type GetTransactionsByPaymentGatewayParams struct {
	CongThanhToanID *string `json:"cong_thanh_toan_id"`
	Limit           int32   `json:"limit"`
	Offset          int32   `json:"offset"`
}

type GetTransactionsByPaymentGatewayRow struct {
	ID                       int32                  `json:"id"`
	DatChoID                 *int32                 `json:"dat_cho_id"`
	NguoiDungID              pgtype.UUID            `json:"nguoi_dung_id"`
	MaGiaoDichNoiBo          string                 `json:"ma_giao_dich_noi_bo"`
	MaThamChieuCongThanhToan *string                `json:"ma_tham_chieu_cong_thanh_toan"`
	CongThanhToanID          *string                `json:"cong_thanh_toan_id"`
	SoTien                   pgtype.Numeric         `json:"so_tien"`
	LoaiGiaoDich             *string                `json:"loai_giao_dich"`
	TrangThai                NullTrangThaiThanhToan `json:"trang_thai"`
	NoiDungChuyenKhoan       *string                `json:"noi_dung_chuyen_khoan"`
	NgayTao                  pgtype.Timestamp       `json:"ngay_tao"`
	NgayHoanThanh            pgtype.Timestamp       `json:"ngay_hoan_thanh"`
	PhuongThucThanhToan      *string                `json:"phuong_thuc_thanh_toan"`
	TenNguoiDung             *string                `json:"ten_nguoi_dung"`
	EmailNguoiDung           *string                `json:"email_nguoi_dung"`
	TenTour                  *string                `json:"ten_tour"`
	TourID                   *int32                 `json:"tour_id"`
	TenCongThanhToan         *string                `json:"ten_cong_thanh_toan"`
}

// Lấy giao dịch theo cổng thanh toán
func (q *Queries) GetTransactionsByPaymentGateway(ctx context.Context, arg GetTransactionsByPaymentGatewayParams) ([]GetTransactionsByPaymentGatewayRow, error) {
	rows, err := q.db.Query(ctx, getTransactionsByPaymentGateway, arg.CongThanhToanID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetTransactionsByPaymentGatewayRow
	for rows.Next() {
		var i GetTransactionsByPaymentGatewayRow
		if err := rows.Scan(
			&i.ID,
			&i.DatChoID,
			&i.NguoiDungID,
			&i.MaGiaoDichNoiBo,
			&i.MaThamChieuCongThanhToan,
			&i.CongThanhToanID,
			&i.SoTien,
			&i.LoaiGiaoDich,
			&i.TrangThai,
			&i.NoiDungChuyenKhoan,
			&i.NgayTao,
			&i.NgayHoanThanh,
			&i.PhuongThucThanhToan,
			&i.TenNguoiDung,
			&i.EmailNguoiDung,
			&i.TenTour,
			&i.TourID,
			&i.TenCongThanhToan,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getTransactionsByStatus = `-- name: GetTransactionsByStatus :many
SELECT 
    lsgd.id,
    lsgd.dat_cho_id,
    lsgd.nguoi_dung_id,
    lsgd.ma_giao_dich_noi_bo,
    lsgd.ma_tham_chieu_cong_thanh_toan,
    lsgd.cong_thanh_toan_id,
    lsgd.so_tien,
    lsgd.loai_giao_dich,
    lsgd.trang_thai,
    lsgd.noi_dung_chuyen_khoan,
    lsgd.ngay_tao,
    lsgd.ngay_hoan_thanh,
    dc.phuong_thuc_thanh_toan,
    nd.ho_ten AS ten_nguoi_dung,
    nd.email AS email_nguoi_dung,
    t.tieu_de AS ten_tour,
    t.id AS tour_id,
    ctt.ten_hien_thi AS ten_cong_thanh_toan
FROM lich_su_giao_dich lsgd
LEFT JOIN dat_cho dc ON dc.id = lsgd.dat_cho_id
LEFT JOIN nguoi_dung nd ON nd.id = lsgd.nguoi_dung_id
LEFT JOIN khoi_hanh_tour kh ON kh.id = dc.khoi_hanh_id
LEFT JOIN tour t ON t.id = kh.tour_id
LEFT JOIN cong_thanh_toan ctt ON ctt.id = lsgd.cong_thanh_toan_id
WHERE lsgd.trang_thai = $1::trang_thai_thanh_toan
ORDER BY lsgd.ngay_tao DESC
LIMIT $2 OFFSET $3
`

type GetTransactionsByStatusParams struct {
	Column1 TrangThaiThanhToan `json:"column_1"`
	Limit   int32              `json:"limit"`
	Offset  int32              `json:"offset"`
}

type GetTransactionsByStatusRow struct {
	ID                       int32                  `json:"id"`
	DatChoID                 *int32                 `json:"dat_cho_id"`
	NguoiDungID              pgtype.UUID            `json:"nguoi_dung_id"`
	MaGiaoDichNoiBo          string                 `json:"ma_giao_dich_noi_bo"`
	MaThamChieuCongThanhToan *string                `json:"ma_tham_chieu_cong_thanh_toan"`
	CongThanhToanID          *string                `json:"cong_thanh_toan_id"`
	SoTien                   pgtype.Numeric         `json:"so_tien"`
	LoaiGiaoDich             *string                `json:"loai_giao_dich"`
	TrangThai                NullTrangThaiThanhToan `json:"trang_thai"`
	NoiDungChuyenKhoan       *string                `json:"noi_dung_chuyen_khoan"`
	NgayTao                  pgtype.Timestamp       `json:"ngay_tao"`
	NgayHoanThanh            pgtype.Timestamp       `json:"ngay_hoan_thanh"`
	PhuongThucThanhToan      *string                `json:"phuong_thuc_thanh_toan"`
	TenNguoiDung             *string                `json:"ten_nguoi_dung"`
	EmailNguoiDung           *string                `json:"email_nguoi_dung"`
	TenTour                  *string                `json:"ten_tour"`
	TourID                   *int32                 `json:"tour_id"`
	TenCongThanhToan         *string                `json:"ten_cong_thanh_toan"`
}

// Lấy giao dịch theo trạng thái
func (q *Queries) GetTransactionsByStatus(ctx context.Context, arg GetTransactionsByStatusParams) ([]GetTransactionsByStatusRow, error) {
	rows, err := q.db.Query(ctx, getTransactionsByStatus, arg.Column1, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetTransactionsByStatusRow
	for rows.Next() {
		var i GetTransactionsByStatusRow
		if err := rows.Scan(
			&i.ID,
			&i.DatChoID,
			&i.NguoiDungID,
			&i.MaGiaoDichNoiBo,
			&i.MaThamChieuCongThanhToan,
			&i.CongThanhToanID,
			&i.SoTien,
			&i.LoaiGiaoDich,
			&i.TrangThai,
			&i.NoiDungChuyenKhoan,
			&i.NgayTao,
			&i.NgayHoanThanh,
			&i.PhuongThucThanhToan,
			&i.TenNguoiDung,
			&i.EmailNguoiDung,
			&i.TenTour,
			&i.TourID,
			&i.TenCongThanhToan,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
