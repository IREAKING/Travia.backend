// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: user.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const changePassword = `-- name: ChangePassword :exec
UPDATE nguoi_dung
SET mat_khau_ma_hoa = $1
WHERE id = $2
`

type ChangePasswordParams struct {
	MatKhauMaHoa string      `json:"mat_khau_ma_hoa"`
	ID           pgtype.UUID `json:"id"`
}

func (q *Queries) ChangePassword(ctx context.Context, arg ChangePasswordParams) error {
	_, err := q.db.Exec(ctx, changePassword, arg.MatKhauMaHoa, arg.ID)
	return err
}

const forgotPassword = `-- name: ForgotPassword :one
UPDATE nguoi_dung
SET mat_khau_ma_hoa = $1
WHERE email = $2
RETURNING id, ho_ten, email, mat_khau_ma_hoa, so_dien_thoai, vai_tro, dang_hoat_dong, xac_thuc, ngay_tao, ngay_cap_nhat
`

type ForgotPasswordParams struct {
	MatKhauMaHoa string `json:"mat_khau_ma_hoa"`
	Email        string `json:"email"`
}

func (q *Queries) ForgotPassword(ctx context.Context, arg ForgotPasswordParams) (NguoiDung, error) {
	row := q.db.QueryRow(ctx, forgotPassword, arg.MatKhauMaHoa, arg.Email)
	var i NguoiDung
	err := row.Scan(
		&i.ID,
		&i.HoTen,
		&i.Email,
		&i.MatKhauMaHoa,
		&i.SoDienThoai,
		&i.VaiTro,
		&i.DangHoatDong,
		&i.XacThuc,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}

const resetPassword = `-- name: ResetPassword :one
UPDATE nguoi_dung
SET mat_khau_ma_hoa = $1
WHERE email = $2
RETURNING id, ho_ten, email, mat_khau_ma_hoa, so_dien_thoai, vai_tro, dang_hoat_dong, xac_thuc, ngay_tao, ngay_cap_nhat
`

type ResetPasswordParams struct {
	MatKhauMaHoa string `json:"mat_khau_ma_hoa"`
	Email        string `json:"email"`
}

func (q *Queries) ResetPassword(ctx context.Context, arg ResetPasswordParams) (NguoiDung, error) {
	row := q.db.QueryRow(ctx, resetPassword, arg.MatKhauMaHoa, arg.Email)
	var i NguoiDung
	err := row.Scan(
		&i.ID,
		&i.HoTen,
		&i.Email,
		&i.MatKhauMaHoa,
		&i.SoDienThoai,
		&i.VaiTro,
		&i.DangHoatDong,
		&i.XacThuc,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}

const updateUser = `-- name: UpdateUser :one
UPDATE nguoi_dung
SET ho_ten = COALESCE($2, nguoi_dung.ho_ten),
    email = COALESCE($3, nguoi_dung.email),
    so_dien_thoai = COALESCE($4, nguoi_dung.so_dien_thoai),
    ngay_cap_nhat = CURRENT_TIMESTAMP
WHERE id = $1 AND nguoi_dung.dang_hoat_dong = TRUE
RETURNING id, ho_ten, email, mat_khau_ma_hoa, so_dien_thoai, vai_tro, dang_hoat_dong, xac_thuc, ngay_tao, ngay_cap_nhat
`

type UpdateUserParams struct {
	ID          pgtype.UUID `json:"id"`
	HoTen       *string     `json:"ho_ten"`
	Email       *string     `json:"email"`
	SoDienThoai *string     `json:"so_dien_thoai"`
}

func (q *Queries) UpdateUser(ctx context.Context, arg UpdateUserParams) (NguoiDung, error) {
	row := q.db.QueryRow(ctx, updateUser,
		arg.ID,
		arg.HoTen,
		arg.Email,
		arg.SoDienThoai,
	)
	var i NguoiDung
	err := row.Scan(
		&i.ID,
		&i.HoTen,
		&i.Email,
		&i.MatKhauMaHoa,
		&i.SoDienThoai,
		&i.VaiTro,
		&i.DangHoatDong,
		&i.XacThuc,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}
