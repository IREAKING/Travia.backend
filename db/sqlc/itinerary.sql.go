// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: itinerary.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createActivity = `-- name: CreateActivity :one

INSERT INTO hoat_dong_trong_ngay (
    lich_trinh_id,
    ten,
    gio_bat_dau,
    gio_ket_thuc,
    mo_ta,
    thu_tu
) VALUES (
    $1, $2, $3, $4, $5, $6
)
RETURNING id, lich_trinh_id, ten, gio_bat_dau, gio_ket_thuc, mo_ta, thu_tu, ngay_tao
`

type CreateActivityParams struct {
	LichTrinhID int32       `json:"lich_trinh_id"`
	Ten         string      `json:"ten"`
	GioBatDau   pgtype.Time `json:"gio_bat_dau"`
	GioKetThuc  pgtype.Time `json:"gio_ket_thuc"`
	MoTa        *string     `json:"mo_ta"`
	ThuTu       *int32      `json:"thu_tu"`
}

// ==================== ACTIVITY QUERIES ====================
func (q *Queries) CreateActivity(ctx context.Context, arg CreateActivityParams) (HoatDongTrongNgay, error) {
	row := q.db.QueryRow(ctx, createActivity,
		arg.LichTrinhID,
		arg.Ten,
		arg.GioBatDau,
		arg.GioKetThuc,
		arg.MoTa,
		arg.ThuTu,
	)
	var i HoatDongTrongNgay
	err := row.Scan(
		&i.ID,
		&i.LichTrinhID,
		&i.Ten,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.MoTa,
		&i.ThuTu,
		&i.NgayTao,
	)
	return i, err
}

const createGroupConfig = `-- name: CreateGroupConfig :one

INSERT INTO cau_hinh_nhom_tour (
    tour_id,
    so_nho_nhat,
    so_lon_nhat
) VALUES (
    $1, $2, $3
)
RETURNING id, tour_id, so_nho_nhat, so_lon_nhat
`

type CreateGroupConfigParams struct {
	TourID    int32  `json:"tour_id"`
	SoNhoNhat *int32 `json:"so_nho_nhat"`
	SoLonNhat *int32 `json:"so_lon_nhat"`
}

// ==================== GROUP CONFIG QUERIES ====================
func (q *Queries) CreateGroupConfig(ctx context.Context, arg CreateGroupConfigParams) (CauHinhNhomTour, error) {
	row := q.db.QueryRow(ctx, createGroupConfig, arg.TourID, arg.SoNhoNhat, arg.SoLonNhat)
	var i CauHinhNhomTour
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.SoNhoNhat,
		&i.SoLonNhat,
	)
	return i, err
}

const createItinerary = `-- name: CreateItinerary :one

INSERT INTO lich_trinh (
    tour_id,
    ngay_thu,
    tieu_de,
    mo_ta,
    gio_bat_dau,
    gio_ket_thuc,
    dia_diem,
    thong_tin_luu_tru
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8
)
RETURNING id, tour_id, ngay_thu, tieu_de, mo_ta, gio_bat_dau, gio_ket_thuc, dia_diem, thong_tin_luu_tru, ngay_tao, ngay_cap_nhat
`

type CreateItineraryParams struct {
	TourID         int32       `json:"tour_id"`
	NgayThu        int32       `json:"ngay_thu"`
	TieuDe         string      `json:"tieu_de"`
	MoTa           *string     `json:"mo_ta"`
	GioBatDau      pgtype.Time `json:"gio_bat_dau"`
	GioKetThuc     pgtype.Time `json:"gio_ket_thuc"`
	DiaDiem        *string     `json:"dia_diem"`
	ThongTinLuuTru *string     `json:"thong_tin_luu_tru"`
}

// ==================== ITINERARY QUERIES ====================
func (q *Queries) CreateItinerary(ctx context.Context, arg CreateItineraryParams) (LichTrinh, error) {
	row := q.db.QueryRow(ctx, createItinerary,
		arg.TourID,
		arg.NgayThu,
		arg.TieuDe,
		arg.MoTa,
		arg.GioBatDau,
		arg.GioKetThuc,
		arg.DiaDiem,
		arg.ThongTinLuuTru,
	)
	var i LichTrinh
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.NgayThu,
		&i.TieuDe,
		&i.MoTa,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.DiaDiem,
		&i.ThongTinLuuTru,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}

const deleteActivitiesByItinerary = `-- name: DeleteActivitiesByItinerary :exec
DELETE FROM hoat_dong_trong_ngay
WHERE lich_trinh_id = $1
`

func (q *Queries) DeleteActivitiesByItinerary(ctx context.Context, lichTrinhID int32) error {
	_, err := q.db.Exec(ctx, deleteActivitiesByItinerary, lichTrinhID)
	return err
}

const deleteActivity = `-- name: DeleteActivity :exec
DELETE FROM hoat_dong_trong_ngay
WHERE id = $1 AND lich_trinh_id = $2
`

type DeleteActivityParams struct {
	ID          int32 `json:"id"`
	LichTrinhID int32 `json:"lich_trinh_id"`
}

func (q *Queries) DeleteActivity(ctx context.Context, arg DeleteActivityParams) error {
	_, err := q.db.Exec(ctx, deleteActivity, arg.ID, arg.LichTrinhID)
	return err
}

const deleteGroupConfig = `-- name: DeleteGroupConfig :exec
DELETE FROM cau_hinh_nhom_tour
WHERE tour_id = $1
`

func (q *Queries) DeleteGroupConfig(ctx context.Context, tourID int32) error {
	_, err := q.db.Exec(ctx, deleteGroupConfig, tourID)
	return err
}

const deleteItinerariesByTour = `-- name: DeleteItinerariesByTour :exec
DELETE FROM lich_trinh
WHERE tour_id = $1
`

func (q *Queries) DeleteItinerariesByTour(ctx context.Context, tourID int32) error {
	_, err := q.db.Exec(ctx, deleteItinerariesByTour, tourID)
	return err
}

const deleteItinerary = `-- name: DeleteItinerary :exec
DELETE FROM lich_trinh
WHERE id = $1 AND tour_id = $2
`

type DeleteItineraryParams struct {
	ID     int32 `json:"id"`
	TourID int32 `json:"tour_id"`
}

func (q *Queries) DeleteItinerary(ctx context.Context, arg DeleteItineraryParams) error {
	_, err := q.db.Exec(ctx, deleteItinerary, arg.ID, arg.TourID)
	return err
}

const getActivitiesByItinerary = `-- name: GetActivitiesByItinerary :many
SELECT id, lich_trinh_id, ten, gio_bat_dau, gio_ket_thuc, mo_ta, thu_tu, ngay_tao FROM hoat_dong_trong_ngay
WHERE lich_trinh_id = $1
ORDER BY thu_tu ASC NULLS LAST, id ASC
`

func (q *Queries) GetActivitiesByItinerary(ctx context.Context, lichTrinhID int32) ([]HoatDongTrongNgay, error) {
	rows, err := q.db.Query(ctx, getActivitiesByItinerary, lichTrinhID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []HoatDongTrongNgay
	for rows.Next() {
		var i HoatDongTrongNgay
		if err := rows.Scan(
			&i.ID,
			&i.LichTrinhID,
			&i.Ten,
			&i.GioBatDau,
			&i.GioKetThuc,
			&i.MoTa,
			&i.ThuTu,
			&i.NgayTao,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getActivityByID = `-- name: GetActivityByID :one
SELECT id, lich_trinh_id, ten, gio_bat_dau, gio_ket_thuc, mo_ta, thu_tu, ngay_tao FROM hoat_dong_trong_ngay
WHERE id = $1
`

func (q *Queries) GetActivityByID(ctx context.Context, id int32) (HoatDongTrongNgay, error) {
	row := q.db.QueryRow(ctx, getActivityByID, id)
	var i HoatDongTrongNgay
	err := row.Scan(
		&i.ID,
		&i.LichTrinhID,
		&i.Ten,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.MoTa,
		&i.ThuTu,
		&i.NgayTao,
	)
	return i, err
}

const getFullItineraryByTour = `-- name: GetFullItineraryByTour :many

SELECT 
    lt.id as itinerary_id,
    lt.tour_id,
    lt.ngay_thu,
    lt.tieu_de as itinerary_title,
    lt.mo_ta as itinerary_description,
    lt.gio_bat_dau as itinerary_start_time,
    lt.gio_ket_thuc as itinerary_end_time,
    lt.dia_diem,
    lt.thong_tin_luu_tru,
    hd.id as activity_id,
    hd.ten as activity_name,
    hd.gio_bat_dau as activity_start_time,
    hd.gio_ket_thuc as activity_end_time,
    hd.mo_ta as activity_description,
    hd.thu_tu as activity_order
FROM lich_trinh lt
LEFT JOIN hoat_dong_trong_ngay hd ON lt.id = hd.lich_trinh_id
WHERE lt.tour_id = $1
ORDER BY lt.ngay_thu ASC, hd.thu_tu ASC NULLS LAST, hd.id ASC
`

type GetFullItineraryByTourRow struct {
	ItineraryID          int32       `json:"itinerary_id"`
	TourID               int32       `json:"tour_id"`
	NgayThu              int32       `json:"ngay_thu"`
	ItineraryTitle       string      `json:"itinerary_title"`
	ItineraryDescription *string     `json:"itinerary_description"`
	ItineraryStartTime   pgtype.Time `json:"itinerary_start_time"`
	ItineraryEndTime     pgtype.Time `json:"itinerary_end_time"`
	DiaDiem              *string     `json:"dia_diem"`
	ThongTinLuuTru       *string     `json:"thong_tin_luu_tru"`
	ActivityID           *int32      `json:"activity_id"`
	ActivityName         *string     `json:"activity_name"`
	ActivityStartTime    pgtype.Time `json:"activity_start_time"`
	ActivityEndTime      pgtype.Time `json:"activity_end_time"`
	ActivityDescription  *string     `json:"activity_description"`
	ActivityOrder        *int32      `json:"activity_order"`
}

// ==================== COMBINED QUERIES ====================
func (q *Queries) GetFullItineraryByTour(ctx context.Context, tourID int32) ([]GetFullItineraryByTourRow, error) {
	rows, err := q.db.Query(ctx, getFullItineraryByTour, tourID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetFullItineraryByTourRow
	for rows.Next() {
		var i GetFullItineraryByTourRow
		if err := rows.Scan(
			&i.ItineraryID,
			&i.TourID,
			&i.NgayThu,
			&i.ItineraryTitle,
			&i.ItineraryDescription,
			&i.ItineraryStartTime,
			&i.ItineraryEndTime,
			&i.DiaDiem,
			&i.ThongTinLuuTru,
			&i.ActivityID,
			&i.ActivityName,
			&i.ActivityStartTime,
			&i.ActivityEndTime,
			&i.ActivityDescription,
			&i.ActivityOrder,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getGroupConfigByTour = `-- name: GetGroupConfigByTour :one
SELECT id, tour_id, so_nho_nhat, so_lon_nhat FROM cau_hinh_nhom_tour
WHERE tour_id = $1
`

func (q *Queries) GetGroupConfigByTour(ctx context.Context, tourID int32) (CauHinhNhomTour, error) {
	row := q.db.QueryRow(ctx, getGroupConfigByTour, tourID)
	var i CauHinhNhomTour
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.SoNhoNhat,
		&i.SoLonNhat,
	)
	return i, err
}

const getItinerariesByTour = `-- name: GetItinerariesByTour :many
SELECT id, tour_id, ngay_thu, tieu_de, mo_ta, gio_bat_dau, gio_ket_thuc, dia_diem, thong_tin_luu_tru, ngay_tao, ngay_cap_nhat FROM lich_trinh
WHERE tour_id = $1
ORDER BY ngay_thu ASC
`

func (q *Queries) GetItinerariesByTour(ctx context.Context, tourID int32) ([]LichTrinh, error) {
	rows, err := q.db.Query(ctx, getItinerariesByTour, tourID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []LichTrinh
	for rows.Next() {
		var i LichTrinh
		if err := rows.Scan(
			&i.ID,
			&i.TourID,
			&i.NgayThu,
			&i.TieuDe,
			&i.MoTa,
			&i.GioBatDau,
			&i.GioKetThuc,
			&i.DiaDiem,
			&i.ThongTinLuuTru,
			&i.NgayTao,
			&i.NgayCapNhat,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getItineraryByID = `-- name: GetItineraryByID :one
SELECT id, tour_id, ngay_thu, tieu_de, mo_ta, gio_bat_dau, gio_ket_thuc, dia_diem, thong_tin_luu_tru, ngay_tao, ngay_cap_nhat FROM lich_trinh
WHERE id = $1
`

func (q *Queries) GetItineraryByID(ctx context.Context, id int32) (LichTrinh, error) {
	row := q.db.QueryRow(ctx, getItineraryByID, id)
	var i LichTrinh
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.NgayThu,
		&i.TieuDe,
		&i.MoTa,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.DiaDiem,
		&i.ThongTinLuuTru,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}

const updateActivity = `-- name: UpdateActivity :one
UPDATE hoat_dong_trong_ngay
SET 
    ten = COALESCE($3, ten),
    gio_bat_dau = COALESCE($4, gio_bat_dau),
    gio_ket_thuc = COALESCE($5, gio_ket_thuc),
    mo_ta = COALESCE($6, mo_ta),
    thu_tu = COALESCE($7, thu_tu)
WHERE id = $1 AND lich_trinh_id = $2
RETURNING id, lich_trinh_id, ten, gio_bat_dau, gio_ket_thuc, mo_ta, thu_tu, ngay_tao
`

type UpdateActivityParams struct {
	ID          int32       `json:"id"`
	LichTrinhID int32       `json:"lich_trinh_id"`
	Ten         *string     `json:"ten"`
	GioBatDau   pgtype.Time `json:"gio_bat_dau"`
	GioKetThuc  pgtype.Time `json:"gio_ket_thuc"`
	MoTa        *string     `json:"mo_ta"`
	ThuTu       *int32      `json:"thu_tu"`
}

func (q *Queries) UpdateActivity(ctx context.Context, arg UpdateActivityParams) (HoatDongTrongNgay, error) {
	row := q.db.QueryRow(ctx, updateActivity,
		arg.ID,
		arg.LichTrinhID,
		arg.Ten,
		arg.GioBatDau,
		arg.GioKetThuc,
		arg.MoTa,
		arg.ThuTu,
	)
	var i HoatDongTrongNgay
	err := row.Scan(
		&i.ID,
		&i.LichTrinhID,
		&i.Ten,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.MoTa,
		&i.ThuTu,
		&i.NgayTao,
	)
	return i, err
}

const updateGroupConfig = `-- name: UpdateGroupConfig :one
UPDATE cau_hinh_nhom_tour
SET 
    so_nho_nhat = COALESCE($2, so_nho_nhat),
    so_lon_nhat = COALESCE($3, so_lon_nhat),
    ngay_cap_nhat = NOW()
WHERE tour_id = $1
RETURNING id, tour_id, so_nho_nhat, so_lon_nhat
`

type UpdateGroupConfigParams struct {
	TourID    int32  `json:"tour_id"`
	SoNhoNhat *int32 `json:"so_nho_nhat"`
	SoLonNhat *int32 `json:"so_lon_nhat"`
}

func (q *Queries) UpdateGroupConfig(ctx context.Context, arg UpdateGroupConfigParams) (CauHinhNhomTour, error) {
	row := q.db.QueryRow(ctx, updateGroupConfig, arg.TourID, arg.SoNhoNhat, arg.SoLonNhat)
	var i CauHinhNhomTour
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.SoNhoNhat,
		&i.SoLonNhat,
	)
	return i, err
}

const updateItinerary = `-- name: UpdateItinerary :one
UPDATE lich_trinh
SET 
    tieu_de = COALESCE($3, tieu_de),
    mo_ta = COALESCE($4, mo_ta),
    gio_bat_dau = COALESCE($5, gio_bat_dau),
    gio_ket_thuc = COALESCE($6, gio_ket_thuc),
    dia_diem = COALESCE($7, dia_diem),
    thong_tin_luu_tru = COALESCE($8, thong_tin_luu_tru),
    ngay_cap_nhat = NOW()
WHERE id = $1 AND tour_id = $2
RETURNING id, tour_id, ngay_thu, tieu_de, mo_ta, gio_bat_dau, gio_ket_thuc, dia_diem, thong_tin_luu_tru, ngay_tao, ngay_cap_nhat
`

type UpdateItineraryParams struct {
	ID             int32       `json:"id"`
	TourID         int32       `json:"tour_id"`
	TieuDe         *string     `json:"tieu_de"`
	MoTa           *string     `json:"mo_ta"`
	GioBatDau      pgtype.Time `json:"gio_bat_dau"`
	GioKetThuc     pgtype.Time `json:"gio_ket_thuc"`
	DiaDiem        *string     `json:"dia_diem"`
	ThongTinLuuTru *string     `json:"thong_tin_luu_tru"`
}

func (q *Queries) UpdateItinerary(ctx context.Context, arg UpdateItineraryParams) (LichTrinh, error) {
	row := q.db.QueryRow(ctx, updateItinerary,
		arg.ID,
		arg.TourID,
		arg.TieuDe,
		arg.MoTa,
		arg.GioBatDau,
		arg.GioKetThuc,
		arg.DiaDiem,
		arg.ThongTinLuuTru,
	)
	var i LichTrinh
	err := row.Scan(
		&i.ID,
		&i.TourID,
		&i.NgayThu,
		&i.TieuDe,
		&i.MoTa,
		&i.GioBatDau,
		&i.GioKetThuc,
		&i.DiaDiem,
		&i.ThongTinLuuTru,
		&i.NgayTao,
		&i.NgayCapNhat,
	)
	return i, err
}
