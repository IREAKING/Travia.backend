### ================================================
### AUTHENTICATION TESTING - Travia Backend
### ================================================
### File này chứa các request để test hệ thống phân quyền đăng nhập
### Sử dụng với VS Code REST Client Extension hoặc Thunder Client

@baseUrl = http://localhost:8080/api
@contentType = application/json

### ================================================
### 1. ĐĂNG NHẬP CHO KHÁCH HÀNG
### ================================================

### 1.1. Đăng nhập khách hàng - THÀNH CÔNG
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "User123456"
}

### 1.2. Đăng nhập khách hàng - SAI MẬT KHẨU
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "wrongpassword"
}

### 1.3. Đăng nhập khách hàng - EMAIL KHÔNG TỒN TẠI
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "notexist@example.com",
  "password": "password123"
}

### ================================================
### 2. ĐĂNG NHẬP CHO ADMIN
### ================================================

### 2.1. Đăng nhập admin - THÀNH CÔNG
POST {{baseUrl}}/auth/login/admin
Content-Type: {{contentType}}

{
  "email": "admin@example.com",
  "password": "Admin123456"
}

### 2.2. Đăng nhập admin - SAI MẬT KHẨU
POST {{baseUrl}}/auth/login/admin
Content-Type: {{contentType}}

{
  "email": "admin@example.com",
  "password": "wrongpassword"
}

### 2.3. Đăng nhập admin - USER KHÁCH HÀNG CỐ ĐĂNG NHẬP VÀO ENDPOINT ADMIN
# Kỳ vọng: 403 Forbidden
POST {{baseUrl}}/auth/login/admin
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "User123456"
}

### ================================================
### 3. ĐĂNG NHẬP CHO NHÀ CUNG CẤP
### ================================================

### 3.1. Đăng nhập nhà cung cấp - THÀNH CÔNG
POST {{baseUrl}}/auth/login/supplier
Content-Type: {{contentType}}

{
  "email": "supplier@example.com",
  "password": "Supplier123456"
}

### 3.2. Đăng nhập nhà cung cấp - SAI MẬT KHẨU
POST {{baseUrl}}/auth/login/supplier
Content-Type: {{contentType}}

{
  "email": "supplier@example.com",
  "password": "wrongpassword"
}

### 3.3. Đăng nhập nhà cung cấp - USER KHÁCH HÀNG CỐ ĐĂNG NHẬP VÀO ENDPOINT NHÀ CUNG CẤP
# Kỳ vọng: 403 Forbidden
POST {{baseUrl}}/auth/login/supplier
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "User123456"
}

### ================================================
### 4. ĐĂNG NHẬP CHUNG (DEPRECATED)
### ================================================

### 4.1. Đăng nhập chung - VẪN HOẠT ĐỘNG
# Endpoint này vẫn hoạt động để backward compatibility
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "User123456"
}

### ================================================
### 5. TEST PHÂN QUYỀN CHÉO (CROSS-ROLE TESTING)
### ================================================

### 5.1. Admin cố đăng nhập endpoint User
# Kỳ vọng: 403 Forbidden
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "admin@example.com",
  "password": "Admin123456"
}

### 5.2. Supplier cố đăng nhập endpoint Admin
# Kỳ vọng: 403 Forbidden
POST {{baseUrl}}/auth/login/admin
Content-Type: {{contentType}}

{
  "email": "supplier@example.com",
  "password": "Supplier123456"
}

### 5.3. User cố đăng nhập endpoint Supplier
# Kỳ vọng: 403 Forbidden
POST {{baseUrl}}/auth/login/supplier
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": "User123456"
}

### ================================================
### 6. TEST VALIDATION
### ================================================

### 6.1. Email trống
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "",
  "password": "password123"
}

### 6.2. Password trống
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "email": "user@example.com",
  "password": ""
}

### 6.3. Request body không hợp lệ
POST {{baseUrl}}/auth/login/user
Content-Type: {{contentType}}

{
  "invalid_field": "test"
}

### ================================================
### 7. TEST VỚI TOKEN
### ================================================
### Lưu ý: Thay thế YOUR_ACCESS_TOKEN bằng token nhận được từ response đăng nhập

@accessToken = YOUR_ACCESS_TOKEN

### 7.1. Get User Info với Token
GET {{baseUrl}}/auth/getUserById/USER_ID_HERE
Authorization: Bearer {{accessToken}}

### 7.2. Đăng xuất
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{accessToken}}

### ================================================
### 8. EXPECTED RESPONSES
### ================================================

### SUCCESS RESPONSE (200):
# {
#   "message": "Đăng nhập thành công",
#   "user": {
#     "id": "uuid-here",
#     "email": "user@example.com",
#     "name": "Nguyen Van A",
#     "role": "khach_hang"
#   },
#   "tokens": {
#     "accessToken": "jwt-token-here",
#     "refreshToken": "refresh-token-here"
#   }
# }

### ERROR RESPONSE - Wrong Credentials (401):
# {
#   "error": "Email hoặc mật khẩu không chính xác"
# }

### ERROR RESPONSE - Wrong Role (403):
# {
#   "error": "Bạn không có quyền đăng nhập vào hệ thống này"
# }

### ERROR RESPONSE - Account Locked (401):
# {
#   "error": "Tài khoản đã bị khóa"
# }

### ERROR RESPONSE - Invalid Input (400):
# {
#   "error": "Dữ liệu đầu vào không hợp lệ",
#   "message": "specific validation error"
# }

### ================================================
### 9. SETUP TEST DATA
### ================================================
### Để test đầy đủ, bạn cần tạo 3 users trong database:

### SQL Script để tạo test users:
# -- User: Khách hàng
# INSERT INTO nguoi_dung (id, ho_ten, email, mat_khau_ma_hoa, vai_tro, dang_hoat_dong, xac_thuc)
# VALUES (
#   gen_random_uuid(),
#   'Test User',
#   'user@example.com',
#   '$2a$10$hashedpassword', -- Hash của 'User123456'
#   'khach_hang',
#   true,
#   true
# );

# -- User: Admin
# INSERT INTO nguoi_dung (id, ho_ten, email, mat_khau_ma_hoa, vai_tro, dang_hoat_dong, xac_thuc)
# VALUES (
#   gen_random_uuid(),
#   'Test Admin',
#   'admin@example.com',
#   '$2a$10$hashedpassword', -- Hash của 'Admin123456'
#   'quan_tri',
#   true,
#   true
# );

# -- User: Nhà cung cấp
# INSERT INTO nguoi_dung (id, ho_ten, email, mat_khau_ma_hoa, vai_tro, dang_hoat_dong, xac_thuc)
# VALUES (
#   gen_random_uuid(),
#   'Test Supplier',
#   'supplier@example.com',
#   '$2a$10$hashedpassword', -- Hash của 'Supplier123456'
#   'nha_cung_cap',
#   true,
#   true
# );

### ================================================
### END OF TESTS
### ================================================

